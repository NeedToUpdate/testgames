//TODO fix this garbage
let ALL_CHARACTER_CONFIG = [
  {
    name: "cat",
    power: "blueenergy",
    color: "white",
  },
  {
    name: "spiderman",
    power: "web",
    color: "red",
  },
  {
    name: "ultraman",
    power: "bluebeam",
    color: "red",
  },
  {
    name: "ironman",
    power: "fire",
    color: "red",
  },
  {
    name: "peppa_pig",
    power: "pinkenergy",
    color: "pink",
  },
  {
    name: "spongebob",
    power: "krabbypatty",
    color: "yellow",
  },
  {
    name: "monkey",
    power: "banana",
    color: "white",
  },
  {
    name: "tiger",
    power: "fire",
    color: "orange",
  },
  {
    name: "shark",
    power: "water",
    color: "blue",
  },
  {
    name: "cinderella",
    power: "blueenergy",
    color: "lightblue",
  },
  {
    name: "elsa",
    power: "ice",
    color: "lightblue",
  },
  {
    name: "ariel",
    power: "water",
    color: "blue",
  },
  {
    name: "dead_fish",
    power: "nuke",
    color: "green",
  },
  {
    name: "mr_krabs",
    power: "spongebobdollar",
    color: "red",
  },
  {
    name: "thanos",
    power: "blackenergy",
    color: "purple",
  },
  {
    name: "pikachu",
    power: "yellowelectric",
    color: "yellow",
  },
  {
    name: "dr_strange",
    power: "magic",
    color: "yellow",
  },
  {
    name: "superman",
    power: "fire",
    color: "blue",
  },
  {
    name: "genie",
    power: "magic",
    color: "blue",
  },
  {
    name: "simba",
    power: "magic",
    color: "yellow",
  },
  {
    name: "captain_marvel",
    power: "electric",
    color: "red",
  },
  {
    name: "mewtwo",
    power: "magic",
    color: "purple",
  },
  {
    name: "sailor_moon",
    power: "pinkenergy",
    color: "pink",
  },
  {
    name: "venom",
    power: "blackenergy",
    color: "black",
  },
  {
    name: "thor",
    power: "electric",
    color: "yellow",
  },
  {
    name: "ultraman2",
    power: "magic",
    color: "blue",
  },
  {
    name: "ultraman3",
    power: "electric",
    color: "blue",
  },
  {
    name: "olaf",
    power: "ice",
    color: "blue",
  },
  {
    name: "hulk",
    power: "rock",
    color: "green",
  },
  {
    name: "gundam",
    power: "bluebeam",
    color: "red",
  },
  {
    name: "optimus",
    power: "bullet",
    color: "red",
  },
  {
    name: "snow_white",
    power: "bluebeam",
    color: "blue",
  },
  {
    name: "deadpool",
    power: "bullet",
    color: "black",
  },
  {
    name: "goku",
    power: "bluebeam",
    color: "yellow",
  },
  {
    name: "ash",
    power: "fire",
    color: "red",
  },
  {
    name: "charizard",
    power: "fire",
    color: "orange",
  },
  {
    name: "captain_america",
    power: "fire",
    color: "blue",
  },
  {
    name: "nakoruru",
    power: "fire",
    color: "red",
  },
  {
    name: "mario",
    power: "fire",
    color: "red",
  },
  {
    name: "emmet",
    power: "legored",
    color: "red",
  },
  {
    name: "wyldstyle",
    power: "blackenergy",
    color: "black",
  },
  {
    name: "tree",
    power: "apple",
    color: "green",
  },
  {
    name: "link",
    power: "blueenergy",
    color: "blue",
  },
  {
    name: "isabelle",
    power: "ac_logo",
    color: "yellow",
  },
  {
    name: "doraemon",
    power: "blueenergy",
    color: "blue",
  },
  {
    name: "hello_kitty",
    power: "pinkenergy",
    color: "pink",
  },
  {
    name: "penguin",
    power: "fish",
    color: "blue",
  },
  {
    name: "rainbow",
    power: "pinkenergy",
    color: "pink",
  },
  {
    name: "zebra",
    power: "fire",
    color: "red",
  },
  {
    name: "sofia",
    power: "robin",
    color: "purple",
  },
  {
    name: "baby",
    power: "water",
    color: "blue",
  },
  {
    name: "starfish",
    power: "stars",
    color: "red",
  },
  {
    name: "bananaman",
    power: "banana",
    color: "yellow",
  },
  {
    name: "arlo",
    power: "rock",
    color: "green",
  },
  {
    name: "black_widow",
    power: "grenade",
    color: "black",
  },
  {
    name: "shrek",
    power: "onion",
    color: "green",
  },
  {
    name: "batman",
    power: "blackenergy",
    color: "black",
  },
  {
    name: "hawkeye",
    power: "arrow",
    color: "black",
  },
  {
    name: "hermione",
    power: "greenenergy",
    color: "blue",
  },
  {
    name: "harry_potter",
    power: "whitemagic",
    color: "red",
  },
  {
    name: "sleeping_beauty",
    power: "pinkenergy",
    color: "pink",
  },
  {
    name: "rapunzel",
    power: "hairbrush",
    color: "pink",
  },
  {
    name: "vision",
    power: "yellowmagic",
    color: "yellow",
  },
  {
    name: "squirtle",
    power: "water",
    color: "blue",
  },
  {
    name: "anna",
    power: "torch",
    color: "pink",
  },
  {
    name: "monkey_king",
    power: "ki",
    color: "yellow",
  },
  {
    name: "shoe",
    power: "smellysocks",
    color: "red",
  },
  {
    name: "arceus",
    power: "whitemagic",
    color: "white",
  },
  {
    name: "luffy",
    power: "fire",
    color: "red",
  },
  {
    name: "ant",
    power: "leaf",
    color: "green",
  },
  {
    name: "dog",
    power: "bone",
    color: "yellow",
  },
  {
    name: "dolphin",
    power: "water",
    color: "blue",
  },
  {
    name: "whale",
    power: "water",
    color: "blue",
  },
  {
    name: "zoro",
    power: "katana",
    color: "green",
  },
  {
    name: "steve",
    power: "grassblock",
    color: "lightblue",
  },
  {
    name: "groot",
    power: "leaf",
    color: "green",
  },
  {
    name: "baby_groot",
    power: "twig",
    color: "green",
  },
  {
    name: "rocket",
    power: "missile",
    color: "red",
  },
];

let powerNames = IMAGE_CONFIG.projectiles.valid_names;

function create_player(num) {
  let chosennum = num || getRandom(ALL_CHARACTER_CONFIG.length);
  if (num === 0) {
    chosennum = 0;
  }
  let charInfo = ALL_CHARACTER_CONFIG[chosennum];
  let char_name = charInfo.name;
  let powr_name = charInfo.power;
  let color = charInfo.color;
  switch (char_name) {
    case "dead_fish":
      powr_name = "nuke";
      break;
    case "snow_white":
      powr_name = "bluebird";
      break;
    case "ash":
      powr_name = "poke";
      break;
    case "captain_america":
      powr_name = "cashield";
      break;
    case "nakoruru":
      powr_name = "mamahaha";
      break;
    case "wyldstyle":
      powr_name = "blacklego";
      break;
    case "link":
      powr_name = "zeldabomb";
      break;
    case "tree":
      powr_name = getRandom(2) ? "apple" : "pear";
      break;
    case "rainbow":
      powr_name = "rainbow";
      break;
    case "cat":
      powr_name = "yarn";
      break;
    case "baby":
      powr_name = "baby_bottle";
      break;
    case "batman":
      powr_name = "batarang";
      break;
    case "sleeping_beauty":
      powr_name = "fairy" + (getRandom(3) + 1);
      break;
    case "arceus":
      powr_name = getRandom(powerNames);
      break;
    case "luffy":
      powr_name = "fist";
      break;
    case "groot":
      powr_name = "tree";
      break;
  }
  return { num: chosennum, name: char_name, power: powr_name, color: color };
}

async function choose_your_fighter_2Team(isTeamA) {
  return new Promise((resolve) => {
    let num_of_choices = 5;
    let chosen_nums = [];
    for (let i = 0; i < num_of_choices; i++) {
      let num = getRandom(ALL_CHARACTER_CONFIG.length);
      while (chosen_nums.includes(num)) {
        num = getRandom(ALL_CHARACTER_CONFIG.length);
      }
      chosen_nums.push(num);
    }
    let screenx = isTeamA ? width * 0.1 : width * 0.6;
    let screenw = width * 0.35;
    let screeny = height * 0.3;
    let screenh = height * 0.3;
    let screen = new Rectangle(screenx, screeny, screenw, screenh);
    let screenstyle = {
      backgroundColor: "grey",
      borderRadius: width / 96 + "px",
      border: (isTeamA ? "blue" : "red") + " solid " + r(width / 183) + "px",
      zIndex: 2050,
    };
    Object.assign(screen.shape.style, screenstyle);
    let crop = new Rectangle(screenx + r(width / 470), screeny + screenh / 3 - 2, screenw, screenh / 3);
    crop.shape.style.overflow = "hidden";
    crop.shape.style.backgroundColor = "yellow";
    crop.shape.style.border = (isTeamA ? "blue" : "red") + " solid " + r(width / 319) + "px";
    crop.shape.style.zIndex = "2060";

    let images = [];
    let lines = [];
    let text = new P("Choose Your Fighter", screenw / 2, height / 20, width * 0.02 + "px").fromCenter();
    let names = [];
    text.shape.style.zIndex = "2070";
    screen.attach(text);
    function start_the_game(num) {
      crop.remove();
      lines.forEach((line) => {
        line.remove();
      });
      names.forEach((name) => {
        name.remove();
      });
      text.remove();
      screen.remove();
      resolve(num);
    }

    chosen_nums.forEach((num, i) => {
      let img = new Img(IMAGE_PATH + IMAGE_CONFIG.characters.path + ALL_CHARACTER_CONFIG[num].name + ".png", (screenw / chosen_nums.length) * i + width / 96, 0, screenw / chosen_nums.length - screenw / 40);
      crop.attach(img);
      if (i !== 0) {
        let line = Line.fromPoints(screenx + width / 191 + (screenw / chosen_nums.length) * i, screeny + screenh / 1.5, screenx + +(screenw / chosen_nums.length) * i + width / 47, screeny + screenh / 3 - width / 300, r(width / 219));
        line.shape.style.backgroundColor = isTeamA ? "blue" : "red";
        line.shape.style.zIndex = "2070";
        lines.push(line);
      }
      img.shape.addEventListener("click", () => {
        start_the_game(num);
      });
      let actual_name = ALL_CHARACTER_CONFIG[num].name
        .split("_")
        .map((x) => x[0].toUpperCase() + x.slice(1, x.length))
        .join(" ");
      if (!isNaN(actual_name[actual_name.length - 1])) {
        actual_name = actual_name.slice(0, actual_name.length - 1);
      }
      let name = new P(actual_name, screenx + (screenw / chosen_nums.length) * (i + 0.1) + 10, 5 + screeny + screenh / 1.5);
      name.set("fontSize", width / 50);
      name.set("zIndex", "2070");
      if (name.width + 20 > screenw / chosen_nums.length) {
        name.string = actual_name.slice(0, 7) + "..";
      }
      name.string = name.string.replace(name.string.charAt(0), name.string.charAt(0).toUpperCase());
      names.push(name);
      images.push(img);
    });
  });
}

function setUpCharacter_2Team(isTeamA, num) {
  return new Promise((resolve) => {
    let vals = create_player(num);
    LOADED_IMAGES.add(vals.power + "_projectile", IMAGE_PATH + "projectiles/");
    let player = isTeamA ? playerA : playerB;
    player = new Character(width * (isTeamA ? 0.28 : 0.72), height - 100, vals.name);
    let sprite = new Img(IMAGE_PATH + "/" + vals.name + ".png", 0, 0, width / 8).fromCenter().onLoad(() => {
      player.addSprite(sprite);
      player.team = isTeamA ? "A" : "B";
      player.addForce(VECTORS.gravity);
      player.maxbounds.x = width * 0.79;
      player.minbounds.x = width * 0.21;
      player.maxbounds.y = height - 20;
      player.minbounds.y = height * 0.2;
      player.powerType = vals.power;
      sprite.set("zIndex", "1000");
      THINGS_TO_UPDATE.push(player);
      player.addDeathImage(LOADED_IMAGES.fire.cloneNode());
      if (isTeamA) {
        playerA = player;
      } else {
        playerB = player;
        player.faceLeft();
      }
      return resolve();
    });
  });
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta charset="UTF-8" name="viewport" content="width=device-width, user-scalable=no">
    <script language="javascript" type="text/javascript" src="./lib/vector.js"></script>
    <script language="javascript" type="text/javascript" src="./lib/drawbase.js"></script>
    <script language="javascript" type="text/javascript" src="./lib/matrix.js"></script>
    <script language="javascript" type="text/javascript" src="./lib/DomObject.js"></script>
    <script language="javascript" type="text/javascript" src="./lib/PhysicsObject.js"></script>
    <script language="javascript" type="text/javascript" src="./lib/Character.js"></script>
    <script language="javascript" type="text/javascript" src="./lib/eventemitter.js"></script>
    <script language="javascript" type="text/javascript" src="./lib/collisioncontainer.js"></script>
    <script language="javascript" type="text/javascript" src="./lib/FallingImg.js"></script>
    <script language="javascript" type="text/javascript" src="./todays_words.js"></script>
    <script language="javascript" type="text/javascript" src="./Letters/keywords_config.js"></script>
    <link rel="stylesheet" type="text/css" href="../global_styles.css">
    <style>
    </style>
</head>
<body>
    <div id="MAIN_WRAPPER">
        <div style="background-color: white"  id="MAIN_SCREEN">

        </div>
    </div>
<script>
    console.log(KEYWORDS_CONFIG)
    setupBody(id('MAIN_SCREEN')).then(()=>{
        setup();
    })


    let CURRENT_REQUIRED_WORDS = [];
    function setup(){
        Array.from(alphabet).forEach((letter,i)=>{
            let keywords = KEYWORDS_CONFIG[letter]
            keywords.forEach((word,j)=>{
                let img = new Img('./Letters/'+ letter + '/' + word + '.png',i*45,j*70,40)
                img.shape.addEventListener('click',()=>{
                    createFaller(word);
                })
            })
        })
        play()
    }

    function createFaller(name){
        let faller = new FallingImg(getRandom(width*0.1,width*0.9),-height/10,name,getRandom(1,3),true)
        FallingImg.createIcon('./Letters/'+ name[0] + '/' + name + '.png',width/10,width/10,'blue').then(x=>{
            faller.hasNoBounds = true;
            faller.addSprite(x)
            faller.doFall()
            faller.maxbounds.y = height*1.2
            faller.doSpin(36000,getRandom(-1)*getRandom(10))
            THINGS_TO_UPDATE.push(faller)
            function handleClick(){
                if(CURRENT_REQUIRED_WORDS.includes(name)){
                    handleCorrectWord(name)
                }else{
                    handleIncorrectWord(name)
                }
                faller.kill()
            }
            x.shape.addEventListener('click',handleClick)
            x.shape.addEventListener('touchstart',handleClick)
        })
    }

    function handleCorrectWord(word){
        console.log('ding')
    }
    function handleIncorrectWord(word){
        console.log('bwap bwap')
    }

    let THINGS_TO_UPDATE = []
    function loop(){
        for(let i = THINGS_TO_UPDATE.length-1; i>=0; i--){
            THINGS_TO_UPDATE[i].update()
            if(THINGS_TO_UPDATE[i].dead){
                THINGS_TO_UPDATE.splice(i,1);
            }
        }
        if(LOOPING) requestAnimationFrame(loop)
    }

    function startDropping(letter){
        let interval = setInterval(()=>{
            createFaller(getRandom(KEYWORDS_CONFIG[letter]))
        },700)
    }
   
</script>

</body>
</html>